<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ fail2ban –¥–ª—è SSH</title>
  <style>
    body {
      font-family: monospace, monospace;
      background-color: #f7f9fc;
      padding: 20px;
      color: #222;
      max-width: 800px;
      margin: auto;
    }
    h1, h2 {
      color: #2c3e50;
    }
    pre {
      background: #eaeaea;
      padding: 15px;
      border-left: 5px solid #3498db;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-bottom: 2em;
    }
    .note {
      background: #fffbdd;
      border-left: 5px solid #f1c40f;
      padding: 15px;
      margin-bottom: 2em;
    }
  </style>
</head>
<body>

  <h1>üîê –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ fail2ban –¥–ª—è SSH</h1>

  <div class="note">
    <strong>–¶–µ–ª—å:</strong> –ó–∞—â–∏—Ç–∏—Ç—å SSH –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π, –±–ª–æ–∫–∏—Ä—É—è IP –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞.<br />
    –ò—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP localhost –∏ —Ç–≤–æ–π –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π IP-–∞–¥—Ä–µ—Å.
  </div>

  <h2>1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ fail2ban</h2>
  <pre><code>sudo apt update
sudo apt install fail2ban -y
</code></pre>

  <h2>2. –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h2>
  <pre><code>sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
</code></pre>

  <h2>3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ <code>jail.local</code> –¥–ª—è SSH</h2>
  <p>–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</p>
  <pre><code>sudo nano /etc/fail2ban/jail.local
</code></pre>

  <p>–ù–∞–π–¥–∏ —Å–µ–∫—Ü–∏—é <code>[sshd]</code> –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –∏–ª–∏ –¥–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏:</p>
  <pre><code>[sshd]
enabled = true
port = 2220                  # –∏–∑–º–µ–Ω–∏—Ç–µ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SSH –ø–æ—Ä—Ç, –∏–Ω–∞—á–µ 22
filter = sshd
logpath = /var/log/auth.log
maxretry = 5                 # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–æ –±–∞–Ω–∞
bantime = 3600               # –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (1 —á–∞—Å)
findtime = 600               # –ø–µ—Ä–∏–æ–¥ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫ (10 –º–∏–Ω—É—Ç)
ignoreip = 127.0.0.1/8 192.168.1.100   # –¥–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å–≤–æ–π IP –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è
</code></pre>

  <h2>4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ fail2ban –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫</h2>
  <pre><code>sudo systemctl restart fail2ban
</code></pre>

  <h2>5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ fail2ban</h2>
  <pre><code>sudo systemctl status fail2ban
sudo fail2ban-client status sshd
</code></pre>

  <h2>6. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ fail2ban (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</h2>
  <pre><code>sudo tail -f /var/log/fail2ban.log
</code></pre>

  <hr />
  <h2>–ö—Ä–∞—Ç–∫–∏–π –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
  <pre><code>sudo apt update
sudo apt install fail2ban -y
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo nano /etc/fail2ban/jail.local
# –í —Å–µ–∫—Ü–∏–∏ [sshd]:
# enabled = true
# port = 2220
# ignoreip = 127.0.0.1/8 YOUR_IP_HERE
sudo systemctl restart fail2ban
sudo systemctl status fail2ban
sudo fail2ban-client status sshd
</code></pre>

  <p>–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å fail2ban –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å IP –ø–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –ø–æ SSH, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–≤–æ–µ–≥–æ IP –∏ localhost.</p>

</body>
</html>
